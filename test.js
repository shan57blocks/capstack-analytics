const strategy = {
  id: 163,
  name: 'ETH/USDT',
  percentage: '0.366771486',
  positions: [
    {
      id: 142,
      protocol: {
        chain: 'BSC',
        logo:
          'https://assets.coingecko.com/coins/images/14165/large/Logo200.png',
        name: 'Alpaca Finance',
      },
      lpToken: '0x0FB881c078434b1C0E4d0B64d8c64d12078b7Ce2',
      tokens: [
        {
          id: 14866,
          address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
          symbol: 'ETH',
          decimals: 18,
        },
        {
          id: 14864,
          address: '0x55d398326f99059ff775485246999027b3197955',
          symbol: 'USDT',
          decimals: 18,
        },
      ],
      liquidationThreshold: 1,
      leverage: 2.599929909674469,
      principals: [
        { balance: 1.4191537940470584, price: 2614.49 },
        { balance: 0, price: 1 },
      ],
      startAssets: [
        { balance: 1.8424178004290541, price: 2614.49 },
        { balance: 4818.108855585749, price: 1 },
      ],
      startBorrows: [
        { balance: 2.2705466015238893, price: 2614.49 },
        { balance: 0, price: 1 },
      ],
      closeAssets: '',
      rewards: ' ',
      openDate: '1646789952',
      closeDate: null,
      closed: false,
      histories: [],
    },
    {
      id: 143,
      protocol: {
        chain: 'BSC',
        logo:
          'https://assets.coingecko.com/coins/images/14165/large/Logo200.png',
        name: 'Alpaca Finance',
      },
      lpToken: '0x0FB881c078434b1C0E4d0B64d8c64d12078b7Ce2',
      tokens: [
        {
          id: 14866,
          address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
          symbol: 'ETH',
          decimals: 18,
        },
        {
          id: 14864,
          address: '0x55d398326f99059ff775485246999027b3197955',
          symbol: 'USDT',
          decimals: 18,
        },
      ],
      liquidationThreshold: 1,
      leverage: 2.598245696830508,
      principals: [
        { balance: 6.050000000000001, price: 2617.98 },
        { balance: 0, price: 1 },
      ],
      startAssets: [
        { balance: 7.85906099301557, price: 2617.98 },
        { balance: 20567.370781816186, price: 1 },
      ],
      startBorrows: [
        { balance: 0, price: 2617.98 },
        { balance: 25314.260379799416, price: 1 },
      ],
      closeAssets: '',
      rewards: ' ',
      openDate: '1646789823',
      closeDate: null,
      closed: false,
      histories: [],
    },
  ],
  principals: '7469153794047050000',
  tokenId: 14866,
}

const positions = [
  {
    id: 142,
    protocol: {
      chain: 'BSC',
      logo: 'https://assets.coingecko.com/coins/images/14165/large/Logo200.png',
      name: 'Alpaca Finance',
    },
    lpToken: '0x0FB881c078434b1C0E4d0B64d8c64d12078b7Ce2',
    tokens: [
      {
        id: 14866,
        address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
        symbol: 'ETH',
        decimals: 18,
      },
      {
        id: 14864,
        address: '0x55d398326f99059ff775485246999027b3197955',
        symbol: 'USDT',
        decimals: 18,
      },
    ],
    liquidationThreshold: 1,
    leverage: 2.599929909674469,
    principals: [
      { balance: 1.4191537940470584, price: 2614.49 },
      { balance: 0, price: 1 },
    ],
    startAssets: [
      { balance: 1.8424178004290541, price: 2614.49 },
      { balance: 4818.108855585749, price: 1 },
    ],
    startBorrows: [
      { balance: 2.2705466015238893, price: 2614.49 },
      { balance: 0, price: 1 },
    ],
    closeAssets: '',
    rewards: ' ',
    openDate: '1646789952',
    closeDate: null,
    closed: false,
    histories: [
      {
        positionId: 142,
        assets: [
          { balance: 1.643394155687761, price: 3300.28 },
          { balance: 5418.525177596285, price: 0.9987 },
        ],
        borrows: [
          { balance: 2.2790941356581103, price: 3300.28 },
          { balance: 0, price: 0.9987 },
        ],
        rewards: [
          { balance: 38.166742560860726, price: 0.4868, symbol: 'ALPACA' },
          { balance: 0.008391913638468638, price: 3300.28, symbol: 'ETH' },
          { balance: 27.669439605148163, price: 0.9987, symbol: 'USDT' },
        ],
        dateKey: 20220328,
        timestamp: 1648435346,
        tokens: [
          {
            id: 14866,
            address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
            symbol: 'ETH',
            decimals: 18,
          },
          {
            id: 14864,
            address: '0x55d398326f99059ff775485246999027b3197955',
            symbol: 'USDT',
            decimals: 18,
          },
        ],
        IL: {
          yearToDate: -74.13314265899498,
          daily: -3.892747588563692,
          yearly: -1420.8528698257476,
          apy: -0.3033673644965865,
        },
        interest: {
          yearToDate: -28.20925595248667,
          daily: -1.481274220214033,
          yearly: -540.665090378122,
          apy: -0.11543780994258396,
        },
        fee: {
          yearToDate: -1267.7693198372795,
          daily: -66.57084517990278,
          yearly: -24298.358490664512,
          apy: -5.187960789923423,
        },
        rewardInfo: {
          yearToDate: 73.90870435505374,
          daily: 3.8809622839737132,
          yearly: 1416.5512336504053,
          apy: 0.30244891892262865,
        },
        netWithoutIL: {
          yearToDate: -1222.0698714347125,
          daily: -64.1711571161431,
          yearly: -23422.472347392235,
          apy: -5.00094968094338,
        },
        net: {
          yearToDate: -1296.2030140937075,
          daily: -68.0639047047068,
          yearly: -24843.325217217982,
          apy: -5.304317045439967,
        },
      },
    ],
    symbol: 'ETH/USDT',
    currentHistory: {
      positionId: 142,
      assets: [
        { balance: 1.643394155687761, price: 3300.28 },
        { balance: 5418.525177596285, price: 0.9987 },
      ],
      borrows: [
        { balance: 2.2790941356581103, price: 3300.28 },
        { balance: 0, price: 0.9987 },
      ],
      rewards: [
        { balance: 38.166742560860726, price: 0.4868, symbol: 'ALPACA' },
        { balance: 0.008391913638468638, price: 3300.28, symbol: 'ETH' },
        { balance: 27.669439605148163, price: 0.9987, symbol: 'USDT' },
      ],
      dateKey: 20220328,
      timestamp: 1648435346,
      tokens: [
        {
          id: 14866,
          address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
          symbol: 'ETH',
          decimals: 18,
        },
        {
          id: 14864,
          address: '0x55d398326f99059ff775485246999027b3197955',
          symbol: 'USDT',
          decimals: 18,
        },
      ],
      IL: {
        yearToDate: -74.13314265899498,
        daily: -3.892747588563692,
        yearly: -1420.8528698257476,
        apy: -0.3033673644965865,
      },
      interest: {
        yearToDate: -28.20925595248667,
        daily: -1.481274220214033,
        yearly: -540.665090378122,
        apy: -0.11543780994258396,
      },
      fee: {
        yearToDate: -1267.7693198372795,
        daily: -66.57084517990278,
        yearly: -24298.358490664512,
        apy: -5.187960789923423,
      },
      rewardInfo: {
        yearToDate: 73.90870435505374,
        daily: 3.8809622839737132,
        yearly: 1416.5512336504053,
        apy: 0.30244891892262865,
      },
      netWithoutIL: {
        yearToDate: -1222.0698714347125,
        daily: -64.1711571161431,
        yearly: -23422.472347392235,
        apy: -5.00094968094338,
      },
      net: {
        yearToDate: -1296.2030140937075,
        daily: -68.0639047047068,
        yearly: -24843.325217217982,
        apy: -5.304317045439967,
      },
    },
  },
  {
    id: 143,
    protocol: {
      chain: 'BSC',
      logo: 'https://assets.coingecko.com/coins/images/14165/large/Logo200.png',
      name: 'Alpaca Finance',
    },
    lpToken: '0x0FB881c078434b1C0E4d0B64d8c64d12078b7Ce2',
    tokens: [
      {
        id: 14866,
        address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
        symbol: 'ETH',
        decimals: 18,
      },
      {
        id: 14864,
        address: '0x55d398326f99059ff775485246999027b3197955',
        symbol: 'USDT',
        decimals: 18,
      },
    ],
    liquidationThreshold: 1,
    leverage: 2.598245696830508,
    principals: [
      { balance: 6.050000000000001, price: 2617.98 },
      { balance: 0, price: 1 },
    ],
    startAssets: [
      { balance: 7.85906099301557, price: 2617.98 },
      { balance: 20567.370781816186, price: 1 },
    ],
    startBorrows: [
      { balance: 0, price: 2617.98 },
      { balance: 25314.260379799416, price: 1 },
    ],
    closeAssets: '',
    rewards: ' ',
    openDate: '1646789823',
    closeDate: null,
    closed: false,
    histories: [
      {
        positionId: 143,
        assets: [
          { balance: 7.012683721113536, price: 3300.28 },
          { balance: 23121.904853964235, price: 0.9987 },
        ],
        borrows: [
          { balance: 0, price: 3300.28 },
          { balance: 25483.66119591334, price: 0.9987 },
        ],
        rewards: [
          { balance: 33.41632418232173, price: 0.4868, symbol: 'ALPACA' },
          { balance: 0.03595254534659079, price: 3300.28, symbol: 'ETH' },
          { balance: 118.54111290644477, price: 0.9987, symbol: 'USDT' },
        ],
        dateKey: 20220328,
        timestamp: 1648435346,
        tokens: [
          {
            id: 14866,
            address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
            symbol: 'ETH',
            decimals: 18,
          },
          {
            id: 14864,
            address: '0x55d398326f99059ff775485246999027b3197955',
            symbol: 'USDT',
            decimals: 18,
          },
        ],
        IL: {
          yearToDate: -314.3514884488286,
          daily: -16.505371606461164,
          yearly: -6024.460636358325,
          apy: -0.3017254952852147,
        },
        interest: {
          yearToDate: -169.18059505297643,
          daily: -8.883013736409131,
          yearly: -3242.3000137893328,
          apy: -0.16238542113127652,
        },
        fee: {
          yearToDate: 1301.9718559138137,
          daily: 68.36146826933049,
          yearly: 24951.93591830563,
          apy: 1.249677884496333,
        },
        rewardInfo: {
          yearToDate: 253.30754242806728,
          daily: 13.300191893875086,
          yearly: 4854.570041264406,
          apy: 0.24313339210108623,
        },
        netWithoutIL: {
          yearToDate: 1386.0988032889045,
          daily: 72.77864642679644,
          yearly: 26564.2059457807,
          apy: 1.3304258554661426,
        },
        net: {
          yearToDate: 1071.747314840076,
          daily: 56.273274820335274,
          yearly: 20539.745309422375,
          apy: 1.028700360180928,
        },
      },
    ],
    symbol: 'ETH/USDT',
    currentHistory: {
      positionId: 143,
      assets: [
        { balance: 7.012683721113536, price: 3300.28 },
        { balance: 23121.904853964235, price: 0.9987 },
      ],
      borrows: [
        { balance: 0, price: 3300.28 },
        { balance: 25483.66119591334, price: 0.9987 },
      ],
      rewards: [
        { balance: 33.41632418232173, price: 0.4868, symbol: 'ALPACA' },
        { balance: 0.03595254534659079, price: 3300.28, symbol: 'ETH' },
        { balance: 118.54111290644477, price: 0.9987, symbol: 'USDT' },
      ],
      dateKey: 20220328,
      timestamp: 1648435346,
      tokens: [
        {
          id: 14866,
          address: '0x2170ed0880ac9a755fd29b2688956bd959f933f8',
          symbol: 'ETH',
          decimals: 18,
        },
        {
          id: 14864,
          address: '0x55d398326f99059ff775485246999027b3197955',
          symbol: 'USDT',
          decimals: 18,
        },
      ],
      IL: {
        yearToDate: -314.3514884488286,
        daily: -16.505371606461164,
        yearly: -6024.460636358325,
        apy: -0.3017254952852147,
      },
      interest: {
        yearToDate: -169.18059505297643,
        daily: -8.883013736409131,
        yearly: -3242.3000137893328,
        apy: -0.16238542113127652,
      },
      fee: {
        yearToDate: 1301.9718559138137,
        daily: 68.36146826933049,
        yearly: 24951.93591830563,
        apy: 1.249677884496333,
      },
      rewardInfo: {
        yearToDate: 253.30754242806728,
        daily: 13.300191893875086,
        yearly: 4854.570041264406,
        apy: 0.24313339210108623,
      },
      netWithoutIL: {
        yearToDate: 1386.0988032889045,
        daily: 72.77864642679644,
        yearly: 26564.2059457807,
        apy: 1.3304258554661426,
      },
      net: {
        yearToDate: 1071.747314840076,
        daily: 56.273274820335274,
        yearly: 20539.745309422375,
        apy: 1.028700360180928,
      },
    },
  },
]

const mapStrategy = (strategy, positions) => {
  let netGain = 0

  positions.forEach((position) => {
    const { currentHistory, tokens } = position
    const index = tokens.findIndex((token) => token.id === strategy.tokenId)
    const tokenPrice = currentHistory.assets[index].price
    netGain += currentHistory.net.yearToDate / tokenPrice
  })
  strategy.netGain = netGain
  return strategy
}

mapStrategy(strategy, positions)
